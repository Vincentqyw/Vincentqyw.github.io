<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/realcat-apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/realcat-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/realcat-32x32.png">
  <link rel="mask-icon" href="/images/realcat-safari-pinned-tab.svg" color="#222">
  <meta name="google-site-verification" content="u46QTaG_Dv3OZLpOBKYtqyuiNtIdnhSG5ASKoNvGBCM">
  <meta name="baidu-site-verification" content="MtcbwE45ft">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.vincentqin.tech","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"show_result":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"waline","storage":true,"lazyload":true,"nav":null,"activeClass":"waline"},"stickytabs":true,"motion":{"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeIn","post_body":"fadeIn","coll_header":"fadeIn","sidebar":"fadeIn"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="最近对深度学习尤其着迷，是时候用万能的Matlab去践行我的DL学习之路了。之所以用Matlab，是因为Matlab真的太强大了！自从大学开始我就一直用这个神奇的软件，算是最熟悉的编程工具。加上最近mathworks公司一大波大佬的不懈努力，在今年下半年发行的R2017b版本中又加入了诸多新颖的特性，尤其在DL方面，可以发现：仅仅几条简单的代码，就能够实现复杂的功能。基于以上，我在本文列举了几">
<meta property="og:type" content="article">
<meta property="og:title" content="Matlab Deep Learning学习笔记">
<meta property="og:url" content="https://www.vincentqin.tech/posts/matlab-deep-learning/index.html">
<meta property="og:site_name" content="RealCat">
<meta property="og:description" content="最近对深度学习尤其着迷，是时候用万能的Matlab去践行我的DL学习之路了。之所以用Matlab，是因为Matlab真的太强大了！自从大学开始我就一直用这个神奇的软件，算是最熟悉的编程工具。加上最近mathworks公司一大波大佬的不懈努力，在今年下半年发行的R2017b版本中又加入了诸多新颖的特性，尤其在DL方面，可以发现：仅仅几条简单的代码，就能够实现复杂的功能。基于以上，我在本文列举了几">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2017-11-18T17:22:40.000Z">
<meta property="article:modified_time" content="2022-09-04T16:48:00.145Z">
<meta property="article:author" content="Vincent Qin">
<meta property="article:tag" content="Deep Learning">
<meta property="article:tag" content="CNN">
<meta property="article:tag" content="CIFAR10">
<meta property="article:tag" content="Matlab">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.vincentqin.tech/posts/matlab-deep-learning/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://www.vincentqin.tech/posts/matlab-deep-learning/","path":"posts/matlab-deep-learning/","title":"Matlab Deep Learning学习笔记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Matlab Deep Learning学习笔记 | RealCat</title>
  
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-97856334-1","only_pageview":true}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>





<link rel="dns-prefetch" href="https://comments.vincentqin.tech">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">RealCat</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Turn on, Tune in, Drop out</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">79</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">15</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">116</span></a></li><li class="menu-item menu-item-collections"><a href="/collections" rel="section"><i class="fa fa-diamond fa-fw"></i>Collections</a></li><li class="menu-item menu-item-guest_comments"><a href="/guestbook" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%8B%E5%86%99%E5%AD%97%E7%AC%A6%E8%AF%86%E5%88%AB"><span class="nav-number">1.</span> <span class="nav-text">手写字符识别</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E5%9B%BE%E5%83%8F%E6%95%B0%E6%8D%AE"><span class="nav-number">1.1.</span> <span class="nav-text">加载图像数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%AE%AD%E7%BB%83%E9%9B%86%E4%B8%8E%E9%AA%8C%E8%AF%81%E9%9B%86"><span class="nav-number">1.2.</span> <span class="nav-text">创建训练集与验证集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84"><span class="nav-number">1.3.</span> <span class="nav-text">创建自己的网络结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E8%AE%AD%E7%BB%83%E5%8F%82%E6%95%B0%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.4.</span> <span class="nav-text">网络训练参数设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E8%AE%AD%E7%BB%83"><span class="nav-number">1.5.</span> <span class="nav-text">开始训练</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B0%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">1.6.</span> <span class="nav-text">测试新的数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%9F%90%E5%B1%82%E5%8F%82%E6%95%B0"><span class="nav-number">1.7.</span> <span class="nav-text">查看某层参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%AD%E5%BB%BA%E7%BD%91%E7%BB%9C%E5%AF%B9cifar10%E5%88%86%E7%B1%BB"><span class="nav-number">2.</span> <span class="nav-text">搭建网络对CIFAR10分类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cifar10"><span class="nav-number">2.1.</span> <span class="nav-text">CIFAR10</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#just-run-it"><span class="nav-number">2.2.</span> <span class="nav-text">Just run it</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E6%9F%90%E5%B1%82%E7%9A%84%E5%8F%82%E6%95%B0"><span class="nav-number">2.3.</span> <span class="nav-text">可视化某层的参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AAresnet"><span class="nav-number">3.</span> <span class="nav-text">搭建一个Resnet</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E6%AF%8F%E4%B8%80%E5%B1%82%E4%B8%8E%E8%BF%9E%E6%8E%A5%E5%B1%82"><span class="nav-number">3.1.</span> <span class="nav-text">定义每一层与连接层</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E9%97%AE%E9%A2%98"><span class="nav-number">4.</span> <span class="nav-text">一些基本问题</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Vincent Qin"
      src="https://vincentqin.gitee.io/images/qin_small.png">
  <p class="site-author-name" itemprop="name">Vincent Qin</p>
  <div class="site-description" itemprop="description">Keep Your Curiosity</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">79</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">116</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Vincentqyw" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Vincentqyw" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:realcat@126.com" title="Email → mailto:realcat@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>Email</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://vincentqin.gitee.io/images/qrcode_wechat.jpg" title="Wechat → https:&#x2F;&#x2F;vincentqin.gitee.io&#x2F;images&#x2F;qrcode_wechat.jpg" rel="noopener" target="_blank"><i class="fab fa-weixin fa-fw"></i>Wechat</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/i_vincent/activities" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;i_vincent&#x2F;activities" rel="noopener" target="_blank"><i class="fab fa-quora fa-fw"></i>Zhihu</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/AlphaRealcat" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;AlphaRealcat" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/18136563" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;18136563" rel="noopener" target="_blank"><i class="fa fa-video-camera fa-fw"></i>Bilibili</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://bafybeic2jt62kpyh6cz2g4ngxs4kazojfw3dhx53mco3wc6f56dejty4xm.ipfs.infura-ipfs.io/" title="Web3.0 → https:&#x2F;&#x2F;bafybeic2jt62kpyh6cz2g4ngxs4kazojfw3dhx53mco3wc6f56dejty4xm.ipfs.infura-ipfs.io" rel="noopener" target="_blank"><i class="link fa-fw"></i>Web3.0</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-dashboard"></i>
      Scholar
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://xxx.itp.ac.cn/" title="http:&#x2F;&#x2F;xxx.itp.ac.cn" rel="noopener" target="_blank">Arxiv-Mirror</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://arxiv-sanity.com/" title="http:&#x2F;&#x2F;arxiv-sanity.com&#x2F;" rel="noopener" target="_blank">Arxiv-sanity</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://openaccess.thecvf.com/menu.py" title="http:&#x2F;&#x2F;openaccess.thecvf.com&#x2F;menu.py" rel="noopener" target="_blank">CVF</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://paperswithcode.com/sota" title="https:&#x2F;&#x2F;paperswithcode.com&#x2F;sota" rel="noopener" target="_blank">Paper&Code</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://scihub.wikicn.top/" title="https:&#x2F;&#x2F;scihub.wikicn.top&#x2F;" rel="noopener" target="_blank">Scihub</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://ras.papercept.net/conferences/scripts/start.pl" title="http:&#x2F;&#x2F;ras.papercept.net&#x2F;conferences&#x2F;scripts&#x2F;start.pl" rel="noopener" target="_blank">RAS</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://openreview.net/" title="https:&#x2F;&#x2F;openreview.net&#x2F;" rel="noopener" target="_blank">OpenReview</a>
        </li>
    </ul>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-battery-three-quarters fa-fw"></i>
      Friends Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.wangpengan.com/" title="http:&#x2F;&#x2F;www.wangpengan.com&#x2F;" rel="noopener" target="_blank">Tensorboy</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://simtalk.cn/" title="http:&#x2F;&#x2F;simtalk.cn&#x2F;" rel="noopener" target="_blank">Simshang</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://sttomato.github.io/" title="https:&#x2F;&#x2F;sttomato.github.io" rel="noopener" target="_blank">Tomato</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://dfine.tech/" title="http:&#x2F;&#x2F;dfine.tech&#x2F;" rel="noopener" target="_blank">Newdee</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://cs-people.bu.edu/yfhu/" title="http:&#x2F;&#x2F;cs-people.bu.edu&#x2F;yfhu&#x2F;" rel="noopener" target="_blank">WhoIf</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://yulunzhang.com/" title="http:&#x2F;&#x2F;yulunzhang.com&#x2F;" rel="noopener" target="_blank">Yulun</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://sanglongbest.github.io/" title="https:&#x2F;&#x2F;sanglongbest.github.io&#x2F;" rel="noopener" target="_blank">YangLiu</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.erenship.com/" title="https:&#x2F;&#x2F;www.erenship.com&#x2F;" rel="noopener" target="_blank">Eren</a>
        </li>
    </ul>
  </div>

  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-briefcase"></i>
      Common Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://comments.vincentqin.tech/ui" title="https:&#x2F;&#x2F;comments.vincentqin.tech&#x2F;ui" rel="noopener" target="_blank">Comments</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://gitee.com/vincentqin/vincentqin" title="https:&#x2F;&#x2F;gitee.com&#x2F;vincentqin&#x2F;vincentqin" rel="noopener" target="_blank">Source</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.notion.so/realcat" title="https:&#x2F;&#x2F;www.notion.so&#x2F;realcat" rel="noopener" target="_blank">Notion</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.matrixcalculus.org/" title="http:&#x2F;&#x2F;www.matrixcalculus.org&#x2F;" rel="noopener" target="_blank">Calculus</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://emojipedia.org/" title="https:&#x2F;&#x2F;emojipedia.org&#x2F;" rel="noopener" target="_blank">Emoji</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://unstoppabledomains.com/" title="https:&#x2F;&#x2F;unstoppabledomains.com&#x2F;" rel="noopener" target="_blank">UD</a>
        </li>
    </ul>
  </div>




        </div>

      <div class="wechat_QR_code">
      <!-- 二维码 -->
      <img src ="https://vincentqin.tech/blog-resources/qrcode_wechat.jpg">
      <span>Follow Me on Wechat</span>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.vincentqin.tech/posts/matlab-deep-learning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://vincentqin.gitee.io/images/qin_small.png">
      <meta itemprop="name" content="Vincent Qin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RealCat">
      <meta itemprop="description" content="Keep Your Curiosity">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Matlab Deep Learning学习笔记 | RealCat">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Matlab Deep Learning学习笔记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-19 01:22:40" itemprop="dateCreated datePublished" datetime="2017-11-19T01:22:40+08:00">2017-11-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-09-05 00:48:00" itemprop="dateModified" datetime="2022-09-05T00:48:00+08:00">2022-09-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline: </span>
  
    <a title="waline" href="/posts/matlab-deep-learning/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/posts/matlab-deep-learning/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-item" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="waline-pageview-count" data-path="/posts/matlab-deep-learning/"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <script src="/assets/js/DPlayer.min.js"> </script><p><img data-src="https://vincentqin.gitee.io/blogresource-1/Matlab-Deep-Learning/cifar10-fig.jpg" /></p>
<div class="note "><p>最近对深度学习尤其着迷，是时候用万能的Matlab去践行我的DL学习之路了。之所以用Matlab，是因为Matlab真的太强大了！自从大学开始我就一直用这个神奇的软件，算是最熟悉的编程工具。加上最近mathworks公司一大波大佬的不懈努力，在今年下半年发行的R2017b版本中又加入了诸多新颖的<a
target="_blank" rel="noopener" href="https://cn.mathworks.com/products/new_products/latest_features.html?s_tid=hp_release_2017b&amp;from=timeline&amp;isappinstalled=0">特性</a>，尤其在<a
target="_blank" rel="noopener" href="https://cn.mathworks.com/solutions/deep-learning.html">DL</a>方面，可以发现：仅仅几条简单的代码，就能够实现复杂的功能。基于以上，我在本文列举了几个在Matlab上学习Deep
Learning的例子：1. <a href="#example1">手写字符识别</a>；2. <a
href="#example2">搭建网络对CIFAR10分类</a>；3.<a
href="#example3">搭建一个Resnet</a>。务必保证主机已经安装Matlab
2017a及以上。</p>
</div>
<span id="more"></span>
<h2 id="手写字符识别"><span id="example1">手写字符识别</span></h2>
<p>利用CNN做数字分类实验。</p>
<p>接下来的实验会阐明如何进行： - 加载图像数据 - 设计网络结构 -
设置网络训练参数 - 训练网络 - 预测新数据的类别</p>
<h3 id="加载图像数据">加载图像数据</h3>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">digitDatasetPath = fullfile(matlabroot,<span class="string">&#x27;toolbox&#x27;</span>,<span class="string">&#x27;nnet&#x27;</span>,<span class="string">&#x27;nndemos&#x27;</span>,...</span><br><span class="line">    <span class="string">&#x27;nndatasets&#x27;</span>,<span class="string">&#x27;DigitDataset&#x27;</span>);</span><br><span class="line"><span class="comment">% imageDatastore函数 能够通过文件夹名自动地把数据存储成ImageDatastore 对象</span></span><br><span class="line">digitData = imageDatastore(digitDatasetPath,...</span><br><span class="line">    <span class="string">&#x27;IncludeSubfolders&#x27;</span>,<span class="built_in">true</span>,<span class="string">&#x27;LabelSource&#x27;</span>,<span class="string">&#x27;foldernames&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">% Display some of the images in the datastore.</span></span><br><span class="line"><span class="built_in">figure</span>;</span><br><span class="line">perm = randperm(<span class="number">10000</span>,<span class="number">25</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:<span class="number">25</span></span><br><span class="line">    subplot(<span class="number">5</span>,<span class="number">5</span>,<span class="built_in">i</span>);</span><br><span class="line">    imshow(digitData.Files&#123;perm(<span class="built_in">i</span>)&#125;);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>以下是手写字符的部分数据：</p>
<p><img data-src="https://vincentqin.gitee.io/blogresource-1/Matlab-Deep-Learning/63361958.png" /></p>
<h3 id="创建训练集与验证集">创建训练集与验证集</h3>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">trainNumFiles = <span class="number">750</span>;</span><br><span class="line">[trainDigitData,valDigitData] = splitEachLabel(digitData,<span class="number">750</span>,<span class="string">&#x27;randomize&#x27;</span>); </span><br><span class="line"><span class="comment">% 每类有1000个，选择其中的750类作为训练集，剩下的作为验证集；此处750可以换成一个比例：75%</span></span><br></pre></td></tr></table></figure>
<p>注意Matlab里面支持的<strong>层</strong>的类型，包括：<a
target="_blank" rel="noopener" href="https://cn.mathworks.com/help/nnet/ref/nnet.cnn.layer.layer.html?searchHighlight=softmaxlayer&amp;s_tid=doc_srchtitle">CLICK
THIS LINK</a>。如下所示：</p>
<table>
<colgroup>
<col style="width: 52%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="header">
<th>Epoch</th>
<th>Iteration</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Layer Type</td>
<td>Function</td>
</tr>
<tr class="even">
<td>Image input layer</td>
<td>imageInputLayer</td>
</tr>
<tr class="odd">
<td>Sequence input layer</td>
<td>sequenceInputLayer</td>
</tr>
<tr class="even">
<td>2-D convolutional layer</td>
<td>convolution2dLayer</td>
</tr>
<tr class="odd">
<td>2-D transposed convolutional layer</td>
<td>transposedConv2dLayer</td>
</tr>
<tr class="even">
<td>Fully connected layer</td>
<td>fullyConnectedLayer</td>
</tr>
<tr class="odd">
<td>Long short-term memory (LSTM) layer</td>
<td>LSTMLayer</td>
</tr>
<tr class="even">
<td>Rectified linear unit (ReLU) layer</td>
<td>reluLayer</td>
</tr>
<tr class="odd">
<td>Leaky rectified linear unit (ReLU) layer</td>
<td>leakyReluLayer</td>
</tr>
<tr class="even">
<td>Clipped rectified linear unit (ReLU) layer</td>
<td>clippedReluLayer</td>
</tr>
<tr class="odd">
<td>Batch normalization layer</td>
<td>batchNormalizationLayer</td>
</tr>
<tr class="even">
<td>Channel-wise local response normalization (LRN) layer</td>
<td>crossChannelNormalizationLayer</td>
</tr>
<tr class="odd">
<td>Dropout layer</td>
<td>dropoutLayer</td>
</tr>
<tr class="even">
<td>Addition layer</td>
<td>additionLayer</td>
</tr>
<tr class="odd">
<td>Depth concatenation layer</td>
<td>depthConcatenationLayer</td>
</tr>
<tr class="even">
<td>Average pooling layer</td>
<td>averagePooling2dLayer</td>
</tr>
<tr class="odd">
<td>Max pooling layer</td>
<td>maxPooling2dLayer</td>
</tr>
<tr class="even">
<td>Max unpooling layer</td>
<td>maxUnpooling2dLayer</td>
</tr>
<tr class="odd">
<td>Softmax layer</td>
<td>softmaxLayer</td>
</tr>
<tr class="even">
<td>Classification layer</td>
<td>classificationLayer</td>
</tr>
<tr class="odd">
<td>Regression layer</td>
<td>regressionLayer</td>
</tr>
</tbody>
</table>
<h3 id="创建自己的网络结构">创建自己的网络结构</h3>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% Define Network Architecture</span></span><br><span class="line"><span class="comment">% Define the convolutional neural network architecture.</span></span><br><span class="line">layers = </span><br><span class="line">    [</span><br><span class="line">    imageInputLayer([<span class="number">28</span> <span class="number">28</span> <span class="number">1</span>])</span><br><span class="line">    convolution2dLayer(<span class="number">3</span>,<span class="number">16</span>,<span class="string">&#x27;Padding&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">    batchNormalizationLayer()</span><br><span class="line">    reluLayer()</span><br><span class="line">    maxPooling2dLayer(<span class="number">2</span>,<span class="string">&#x27;Stride&#x27;</span>,<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    convolution2dLayer(<span class="number">3</span>,<span class="number">32</span>,<span class="string">&#x27;Padding&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">    batchNormalizationLayer()</span><br><span class="line">    reluLayer()</span><br><span class="line">    </span><br><span class="line">    maxPooling2dLayer(<span class="number">2</span>,<span class="string">&#x27;Stride&#x27;</span>,<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    convolution2dLayer(<span class="number">3</span>,<span class="number">64</span>,<span class="string">&#x27;Padding&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">    batchNormalizationLayer()</span><br><span class="line">    reluLayer()</span><br><span class="line">    </span><br><span class="line">    fullyConnectedLayer(<span class="number">10</span>)</span><br><span class="line">    softmaxLayer()</span><br><span class="line">    classificationLayer()</span><br><span class="line">    ];</span><br></pre></td></tr></table></figure>
<p>以下就是该网络结构及参数设置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Image</span> <span class="title class_">Input</span>             28x28x1 images <span class="keyword">with</span> <span class="string">&#x27;zerocenter&#x27;</span> normalization</span><br><span class="line"><span class="title class_">Convolution</span>             <span class="number">16</span> 3x3 convolutions <span class="keyword">with</span> stride [<span class="number">1</span>  <span class="number">1</span>] and padding [<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>]</span><br><span class="line"><span class="title class_">Batch</span> <span class="title class_">Normalization</span>     <span class="title class_">Batch</span> normalization</span><br><span class="line"><span class="title class_">ReLU</span>                    <span class="title class_">ReLU</span></span><br><span class="line"><span class="title class_">Max</span> <span class="title class_">Pooling</span>             2x2 max pooling <span class="keyword">with</span> stride [<span class="number">2</span>  <span class="number">2</span>] and padding [<span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>]</span><br><span class="line"><span class="title class_">Convolution</span>             <span class="number">32</span> 3x3 convolutions <span class="keyword">with</span> stride [<span class="number">1</span>  <span class="number">1</span>] and padding [<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>]</span><br><span class="line"><span class="title class_">Batch</span> <span class="title class_">Normalization</span>     <span class="title class_">Batch</span> normalization</span><br><span class="line"><span class="title class_">ReLU</span>                    <span class="title class_">ReLU</span></span><br><span class="line"><span class="title class_">Max</span> <span class="title class_">Pooling</span>             2x2 max pooling <span class="keyword">with</span> stride [<span class="number">2</span>  <span class="number">2</span>] and padding [<span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>]</span><br><span class="line"><span class="title class_">Convolution</span>             <span class="number">64</span> 3x3 convolutions <span class="keyword">with</span> stride [<span class="number">1</span>  <span class="number">1</span>] and padding [<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>]</span><br><span class="line"><span class="title class_">Batch</span> <span class="title class_">Normalization</span>     <span class="title class_">Batch</span> normalization</span><br><span class="line"><span class="title class_">ReLU</span>                    <span class="title class_">ReLU</span></span><br><span class="line"><span class="title class_">Fully</span> <span class="title class_">Connected</span>         <span class="number">10</span> fully connected layer</span><br><span class="line"><span class="title class_">Softmax</span>                 softmax</span><br><span class="line"><span class="title class_">Classification</span> <span class="title class_">Output</span>   crossentropyex</span><br></pre></td></tr></table></figure>
<h3 id="网络训练参数设计">网络训练参数设计</h3>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> options = trainingOptions(<span class="string">&#x27;sgdm&#x27;</span>,...</span><br><span class="line"><span class="string">&#x27;MaxEpochs&#x27;</span>,<span class="number">3</span>, ...                 <span class="comment">% 训练最大轮回</span></span><br><span class="line"><span class="string">&#x27;ValidationData&#x27;</span>,valDigitData,...  <span class="comment">% 验证集</span></span><br><span class="line"><span class="string">&#x27;ValidationFrequency&#x27;</span>,<span class="number">30</span>,...</span><br><span class="line"><span class="string">&#x27;Verbose&#x27;</span>,<span class="built_in">false</span>,...</span><br><span class="line"><span class="string">&#x27;Plots&#x27;</span>,<span class="string">&#x27;training-progress&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="开始训练">开始训练</h3>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net = trainNetwork(trainDigitData,layers,options);</span><br></pre></td></tr></table></figure>
<h3 id="测试新的数据">测试新的数据</h3>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">predictedLabels = classify(net,valDigitData);</span><br><span class="line">valLabels = valDigitData.Labels;</span><br><span class="line">accuracy = sum(predictedLabels == valLabels)/<span class="built_in">numel</span>(valLabels)</span><br></pre></td></tr></table></figure>
<h3 id="查看某层参数">查看某层参数</h3>
<p>例如查看第2层的weight参数，输入以下命令： <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">montage(imresize(mat2gray(net.Layers(<span class="number">2</span>).Weights),[<span class="number">128</span> <span class="number">128</span>]));</span><br><span class="line">set(gcf,<span class="string">&#x27;color&#x27;</span>,[<span class="number">1</span> <span class="number">1</span> <span class="number">1</span>]); </span><br><span class="line">frame=getframe(gcf); <span class="comment">% get the frame</span></span><br><span class="line">image=frame.cdata;</span><br><span class="line">[image,map]     =  rgb2ind(image,<span class="number">256</span>);  </span><br><span class="line">imwrite(image,map,<span class="string">&#x27;weight-layer2.png&#x27;</span>); </span><br></pre></td></tr></table></figure>
图像如下所示： <img data-src="https://vincentqin.gitee.io/blogresource-1/Matlab-Deep-Learning/weight-layer2.png" /></p>
<p>再看一下第10层的参数： <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[~,~,iter,~]=<span class="built_in">size</span>(net.Layers(<span class="number">10</span>).Weights);</span><br><span class="line">name=<span class="string">&#x27;weight.gif&#x27;</span>;</span><br><span class="line">dt=<span class="number">0.4</span>;</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:iter</span><br><span class="line">	montage(imresize(mat2gray(net.Layers(<span class="number">10</span>).Weights(:,:,<span class="built_in">i</span>,:)),[<span class="number">128</span> <span class="number">128</span>]));</span><br><span class="line">    set(gcf,<span class="string">&#x27;color&#x27;</span>,[<span class="number">1</span> <span class="number">1</span> <span class="number">1</span>]); <span class="comment">%变白</span></span><br><span class="line">	title([<span class="string">&#x27;Layer(10), Channel: &#x27;</span>,num2str(<span class="built_in">i</span>)]);</span><br><span class="line">	axis normal</span><br><span class="line">	<span class="built_in">true</span><span class="built_in">size</span></span><br><span class="line">	<span class="comment">%Creat GIF</span></span><br><span class="line">	frame(<span class="built_in">i</span>)=getframe(gcf); <span class="comment">% get the frame</span></span><br><span class="line">	image=frame(<span class="built_in">i</span>).cdata;</span><br><span class="line">	[image,map]     =  rgb2ind(image,<span class="number">256</span>);  </span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">i</span>==<span class="number">1</span></span><br><span class="line">		 imwrite(image,map,name,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		 imwrite(image,map,name,<span class="string">&#x27;gif&#x27;</span>,<span class="string">&#x27;WriteMode&#x27;</span>,<span class="string">&#x27;append&#x27;</span>,<span class="string">&#x27;DelayTime&#x27;</span>,dt);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p><img data-src="https://vincentqin.gitee.io/blogresource-1/Matlab-Deep-Learning/weight-inf.gif" /></p>
<h2 id="搭建网络对cifar10分类"><span
id="example2">搭建网络对CIFAR10分类</span></h2>
<p>CIFAR10和CIFAR100是<a
target="_blank" rel="noopener" href="http://groups.csail.mit.edu/vision/TinyImages/">80 million tiny
images</a>的子集，是由Geoffrey Hinton的弟子们Alex Krizhevsky和Vinod
Nair共同采集。</p>
<h3 id="cifar10"><a
target="_blank" rel="noopener" href="http://www.cs.toronto.edu/~kriz/cifar.html">CIFAR10</a></h3>
<p>CIFAR10由60000张32*32的彩色图像组成，一种分成10类，平均每类图像6000张。共有50000张训练图像，10000张测试图像。这个数据集被分成了5个分支，其中每个分支10000张。测试集包含每类中随机选择的1000张图像。训练集就是剩下的那些图像。</p>
<p>对于每个分支的数据的大小是：10000*3072；其中3072=32*32*3。数据以行优先的顺序存储，所以前1024个数据是r通道的数据，接下来的1024个数据是g通道的数据，最后1024个数据是b通道的。
假如原始的数据是data，我们想要将其重新排列成我们需要的数据。首先对其进行转置，然后再用reshape函数对图像重组（可选：最后将图像前两维互换（转置），之所以这么做，可以更好的可视化）。</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">XBatch = data&#x27;;</span><br><span class="line">XBatch = <span class="built_in">reshape</span>(XBatch, <span class="number">32</span>,<span class="number">32</span>,<span class="number">3</span>,[]);</span><br><span class="line">XBatch = <span class="built_in">permute</span>(XBatch, [<span class="number">2</span> <span class="number">1</span> <span class="number">3</span> <span class="number">4</span>]);</span><br></pre></td></tr></table></figure>
<p>以下是cifar10的部分数据。 <img data-src="https://vincentqin.gitee.io/blogresource-1/Matlab-Deep-Learning/cifar10-images.png" />
共有10类，包括：airplane，automobile，bird，cat，deer，dog，frog，horse，ship，truck。</p>
<h3 id="just-run-it">Just run it</h3>
<p>接下来我们就开始运行以下代码，来训练我们的网络。闲话少说，我把代码放在了<a
target="_blank" rel="noopener" href="https://github.com/Vincentqyw/DeepLearning/blob/master/demo_cifar10.m">Github</a>，欢迎<span
class="math inline">\(star\)</span>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>   <span class="string">&#x27;imageinput&#x27;</span>    <span class="title class_">Image</span> <span class="title class_">Input</span>         	28x28x1 images <span class="keyword">with</span> <span class="string">&#x27;zerocenter&#x27;</span> normalization</span><br><span class="line"><span class="number">2</span>   <span class="string">&#x27;conv_1&#x27;</span>        <span class="title class_">Convolution</span>         	<span class="number">16</span> 3x3x1 convolutions <span class="keyword">with</span> stride [<span class="number">1</span>  <span class="number">1</span>] and padding [<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>]</span><br><span class="line"><span class="number">3</span>   <span class="string">&#x27;batchnorm_1&#x27;</span>   <span class="title class_">Batch</span> <span class="title class_">Normalization</span> 	<span class="title class_">Batch</span> normalization <span class="keyword">with</span> <span class="number">16</span> channels</span><br><span class="line"><span class="number">4</span>   <span class="string">&#x27;relu_1&#x27;</span>        <span class="title class_">ReLU</span>               		<span class="title class_">ReLU</span></span><br><span class="line"><span class="number">5</span>   <span class="string">&#x27;maxpool_1&#x27;</span>     <span class="title class_">Max</span> <span class="title class_">Pooling</span>         	2x2 max pooling <span class="keyword">with</span> stride [<span class="number">2</span>  <span class="number">2</span>] and padding [<span class="number">0</span> <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>]</span><br><span class="line"><span class="number">6</span>   <span class="string">&#x27;conv_2&#x27;</span>        <span class="title class_">Convolution</span>         	<span class="number">32</span> 3x3x16 convolutions <span class="keyword">with</span> stride [<span class="number">1</span>  <span class="number">1</span>] and padding [<span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>]</span><br><span class="line"><span class="number">7</span>   <span class="string">&#x27;batchnorm_2&#x27;</span>   <span class="title class_">Batch</span> <span class="title class_">Normalization</span> 	<span class="title class_">Batch</span> normalization <span class="keyword">with</span> <span class="number">32</span> channels</span><br><span class="line"><span class="number">8</span>   <span class="string">&#x27;relu_2&#x27;</span>        <span class="title class_">ReLU</span>                	<span class="title class_">ReLU</span></span><br><span class="line"><span class="number">9</span>   <span class="string">&#x27;maxpool_2&#x27;</span>     <span class="title class_">Max</span> <span class="title class_">Pooling</span>         	2x2 max pooling <span class="keyword">with</span> stride [<span class="number">2</span>  <span class="number">2</span>] and padding [<span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span> <span class="number">0</span>]</span><br><span class="line"><span class="number">10</span>   <span class="string">&#x27;conv_3&#x27;</span>       <span class="title class_">Convolution</span>         	<span class="number">64</span> 3x3x32 convolutions <span class="keyword">with</span> stride [<span class="number">1</span>  <span class="number">1</span>] and padding [<span class="number">1</span> <span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>]</span><br><span class="line"><span class="number">11</span>   <span class="string">&#x27;batchnorm_3&#x27;</span>  <span class="title class_">Batch</span> <span class="title class_">Normalization</span> 	<span class="title class_">Batch</span> normalization <span class="keyword">with</span> <span class="number">64</span> channels</span><br><span class="line"><span class="number">12</span>   <span class="string">&#x27;relu_3&#x27;</span>       <span class="title class_">ReLU</span>			<span class="title class_">ReLU</span></span><br><span class="line"><span class="number">13</span>   <span class="string">&#x27;fc&#x27;</span>           <span class="title class_">Fully</span> <span class="title class_">Connected</span>		<span class="number">10</span> fully connected layer</span><br><span class="line"><span class="number">14</span>   <span class="string">&#x27;softmax&#x27;</span>      <span class="title class_">Softmax</span>			softmax</span><br><span class="line"><span class="number">15</span>   <span class="string">&#x27;classoutput&#x27;</span>  <span class="title class_">Classification</span> <span class="title class_">Output</span>	crossentropyex <span class="keyword">with</span> <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, and <span class="number">8</span> other classes</span><br></pre></td></tr></table></figure>
<p>以下是训练过程输出：</p>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 17%" />
<col style="width: 21%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 13%" />
</colgroup>
<thead>
<tr class="header">
<th>Epoch</th>
<th>Iteration</th>
<th style="text-align: center;">Time Elapsed (seconds)</th>
<th style="text-align: center;">Mini-batch Loss</th>
<th style="text-align: center;">Mini-batch Accuracy</th>
<th style="text-align: center;">Base Learning Rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td style="text-align: center;">0.06</td>
<td style="text-align: center;">2.3026</td>
<td style="text-align: center;">8.59%</td>
<td style="text-align: center;">0.0020</td>
</tr>
<tr class="even">
<td>1</td>
<td>50</td>
<td style="text-align: center;">1.27</td>
<td style="text-align: center;">2.3026</td>
<td style="text-align: center;">14.06%</td>
<td style="text-align: center;">0.0020</td>
</tr>
<tr class="odd">
<td>1</td>
<td>100</td>
<td style="text-align: center;">2.52</td>
<td style="text-align: center;">2.3024</td>
<td style="text-align: center;">7.81%</td>
<td style="text-align: center;">0.0020</td>
</tr>
<tr class="even">
<td>1</td>
<td>150</td>
<td style="text-align: center;">3.73</td>
<td style="text-align: center;">2.2999</td>
<td style="text-align: center;">20.31%</td>
<td style="text-align: center;">0.0020</td>
</tr>
<tr class="odd">
<td>1</td>
<td>200</td>
<td style="text-align: center;">5.01</td>
<td style="text-align: center;">2.2740</td>
<td style="text-align: center;">15.63%</td>
<td style="text-align: center;">0.0020</td>
</tr>
<tr class="even">
<td>1</td>
<td>250</td>
<td style="text-align: center;">6.28</td>
<td style="text-align: center;">2.1194</td>
<td style="text-align: center;">21.09%</td>
<td style="text-align: center;">0.0020</td>
</tr>
<tr class="odd">
<td>1</td>
<td>300</td>
<td style="text-align: center;">7.58</td>
<td style="text-align: center;">1.9100</td>
<td style="text-align: center;">23.44%</td>
<td style="text-align: center;">0.0020</td>
</tr>
<tr class="even">
<td>1</td>
<td>350</td>
<td style="text-align: center;">8.86</td>
<td style="text-align: center;">1.8892</td>
<td style="text-align: center;">28.13%</td>
<td style="text-align: center;">0.0020</td>
</tr>
<tr class="odd">
<td>2</td>
<td>400</td>
<td style="text-align: center;">10.08</td>
<td style="text-align: center;">1.7490</td>
<td style="text-align: center;">29.69%</td>
<td style="text-align: center;">0.0020</td>
</tr>
<tr class="even">
<td>2</td>
<td>450</td>
<td style="text-align: center;">11.32</td>
<td style="text-align: center;">1.8377</td>
<td style="text-align: center;">31.25%</td>
<td style="text-align: center;">0.0020</td>
</tr>
<tr class="odd">
<td>2</td>
<td>500</td>
<td style="text-align: center;">12.57</td>
<td style="text-align: center;">1.6073</td>
<td style="text-align: center;">39.84%</td>
<td style="text-align: center;">0.0020</td>
</tr>
<tr class="even">
<td>...</td>
<td>...</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">...</td>
<td style="text-align: center;">...</td>
</tr>
<tr class="odd">
<td>20</td>
<td>7650</td>
<td style="text-align: center;">407.74</td>
<td style="text-align: center;">0.2858</td>
<td style="text-align: center;">93.75%</td>
<td style="text-align: center;">2.00e-05</td>
</tr>
<tr class="even">
<td>20</td>
<td>7700</td>
<td style="text-align: center;">409.06</td>
<td style="text-align: center;">0.3127</td>
<td style="text-align: center;">89.84%</td>
<td style="text-align: center;">2.00e-05</td>
</tr>
<tr class="odd">
<td>20</td>
<td>7750</td>
<td style="text-align: center;">410.38</td>
<td style="text-align: center;">0.3254</td>
<td style="text-align: center;">87.50%</td>
<td style="text-align: center;">2.00e-05</td>
</tr>
<tr class="even">
<td>20</td>
<td>7800</td>
<td style="text-align: center;">411.64</td>
<td style="text-align: center;">0.2456</td>
<td style="text-align: center;">92.19%</td>
<td style="text-align: center;">2.00e-05</td>
</tr>
</tbody>
</table>
<p>最后测试我们的模型的性能，accuracy=76%左右。但是训练时，我们的batch-accuracy已经达到了90%以上，说明我们的<strong>模型过拟合</strong>了。显然这不是我们想要的结果，进一步的调参将会在此补充。</p>
<h3 id="可视化某层的参数">可视化某层的参数</h3>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% Extract the first convolutional layer weights</span></span><br><span class="line">w = cifar10Net.Layers(<span class="number">2</span>).Weights;</span><br><span class="line"></span><br><span class="line"><span class="comment">% rescale and resize the weights for better visualization</span></span><br><span class="line">w = mat2gray(w);</span><br><span class="line">w = imresize(w, [<span class="number">100</span> <span class="number">100</span>]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">figure</span></span><br><span class="line">montage(w)</span><br><span class="line">name=<span class="string">&#x27;cifar10-weight-layer2&#x27;</span>;</span><br><span class="line">set(gcf,<span class="string">&#x27;color&#x27;</span>,[<span class="number">1</span> <span class="number">1</span> <span class="number">1</span>]);</span><br><span class="line">frame=getframe(gcf); <span class="comment">% get the frame</span></span><br><span class="line">image=frame.cdata;</span><br><span class="line">[image,map]     =  rgb2ind(image,<span class="number">256</span>);  </span><br><span class="line">imwrite(image,map,[name,<span class="string">&#x27;.png&#x27;</span>]); </span><br></pre></td></tr></table></figure>
<p><img data-src="https://vincentqin.gitee.io/blogresource-1/Matlab-Deep-Learning/cifar10-weight-layer2.png" /></p>
<h2 id="搭建一个resnet"><span id="example3">搭建一个Resnet</span></h2>
<p>接下来，为了验证下这个DL工具包的强大之处，我打算纯手工建一个Resnet。为方便起见，我搭了一个Resnet34（更深的网络敬请期待吧）。这里是它的<a
href="./resnet34.prototxt">prototxt</a>，我们可以用<a
target="_blank" rel="noopener" href="http://ethereon.github.io/netscope/#/editor">网络可视化工具</a>进行查看resnet34的结构。以下是Resnet34的一部分（太长了没有截下全部视图）。
<img data-src="https://vincentqin.gitee.io/blogresource-1/Matlab-Deep-Learning/resnet34.png" /></p>
<h3 id="定义每一层与连接层">定义每一层与连接层</h3>
<p>以从pool1到res2a为例子建立网络。</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">layers_example=[</span><br><span class="line">    <span class="comment">% pool1 - res2a</span></span><br><span class="line">    maxPooling2dLayer(<span class="number">3</span>, <span class="string">&#x27;Stride&#x27;</span>, <span class="number">2</span>,<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;pool1&#x27;</span>);</span><br><span class="line">    <span class="comment">%  branch2a </span></span><br><span class="line">    convolution2dLayer(<span class="number">3</span>,<span class="number">64</span>,<span class="string">&#x27;Stride&#x27;</span>, <span class="number">1</span>,<span class="string">&#x27;Padding&#x27;</span>, <span class="number">1</span>,<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;res2a_branch2a&#x27;</span>)</span><br><span class="line">    batchNormalizationLayer(<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;bn2a_branch2a&#x27;</span>)</span><br><span class="line">    reluLayer(<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;res2a_branch2a_relu&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">%  branch2b</span></span><br><span class="line">    convolution2dLayer(<span class="number">3</span>,<span class="number">64</span>,<span class="string">&#x27;Stride&#x27;</span>, <span class="number">1</span>,<span class="string">&#x27;Padding&#x27;</span>, <span class="number">1</span>,<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;res2a_branch2b&#x27;</span>)</span><br><span class="line">    batchNormalizationLayer(<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;bn2a_branch2b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">% add together</span></span><br><span class="line">    additionLayer(<span class="number">2</span>,<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;res2a&#x27;</span>)</span><br><span class="line">    reluLayer(<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;res2a_relu&#x27;</span>)</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>上述过程仅仅完成了网络的一个小分支，记下来要完成<code>res2a_branch1</code>这部分的连接。这时候要用到<strong>DAG</strong>的<a
target="_blank" rel="noopener" href="https://cn.mathworks.com/help/nnet/ref/dagnetwork.html">一些方法</a>。通过添加新层同时建立新的连接即可，方式如下。</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lgraph = layerGraph(layers_example);</span><br><span class="line"><span class="built_in">figure</span></span><br><span class="line"><span class="built_in">plot</span>(lgraph)</span><br><span class="line"></span><br><span class="line"><span class="comment">%% add some connections (shortcut)</span></span><br><span class="line">layers_2a=[</span><br><span class="line">    convolution2dLayer(<span class="number">1</span>,<span class="number">64</span>,<span class="string">&#x27;Stride&#x27;</span>, <span class="number">1</span>,<span class="string">&#x27;Padding&#x27;</span>, <span class="number">0</span>,<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;res2a_branch1&#x27;</span>)</span><br><span class="line">    batchNormalizationLayer(<span class="string">&#x27;Name&#x27;</span>,<span class="string">&#x27;bn2a_branch1&#x27;</span>)</span><br><span class="line">];</span><br><span class="line">lgraph = addLayers(lgraph,layers_2a);</span><br><span class="line">lgraph = connectLayers(lgraph,<span class="string">&#x27;pool1&#x27;</span>,<span class="string">&#x27;res2a_branch1&#x27;</span>);</span><br><span class="line">lgraph = connectLayers(lgraph,<span class="string">&#x27;bn2a_branch1&#x27;</span>,<span class="string">&#x27;res2a/in2&#x27;</span>);</span><br><span class="line"><span class="comment">% show net</span></span><br><span class="line"><span class="built_in">plot</span>(lgraph)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其他部分的构建同上，经过一系列重复的工作，我们可以构建出这个不太深的Resnet34，全部代码见我的<a
target="_blank" rel="noopener" href="https://github.com/Vincentqyw/DeepLearning">Github</a>。</p>
<h2 id="一些基本问题">一些基本问题</h2>
<ul>
<li>参数的基本格式</li>
</ul>
<p><span class="math display">\[Height \times Width \times (\#Channels)
\times (\#Filters)\]</span></p>
<ul>
<li><p>SGD是什么？ 可以参见好友写的一篇<a
target="_blank" rel="noopener" href="https://sttomato.github.io/2017/08/13/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/#随机梯度下降">博文</a>。</p></li>
<li><p>什么是epoch？ 模型训练的时候一般采用stochastic gradient
descent（SGD），一次迭代选取一个batch进行update。一个epoch的意思就是迭代次数*batch的数目
和训练数据的个数一样，就是一个epoch。</p></li>
<li><p>为什么要是用BN？ Batch normalization layers normalize the
activations and gradients propagating through a network, making network
training an easier optimization problem. Use batch normalization layers
between convolutional layers and nonlinearities, such as ReLU layers, to
speed up network training and reduce the sensitivity to network
initialization.</p></li>
<li><p>RELU的作用？ <em>Max-Pooling Layer</em> Convolutional layers
(with activation functions) are sometimes followed by a down-sampling
operation that reduces the spatial size of the feature map and removes
redundant spatial information. Down-sampling makes it possible to
increase the number of filters in deeper convolutional layers without
increasing the required amount of computation per layer. One way of
down-sampling is using a max pooling. The max pooling layer returns the
maximum values of rectangular regions of inputs.</p></li>
<li><p>Resnet中scale层是如何定义的？有什么用途？</p></li>
<li><p>Resnet中为何残差<span class="math inline">\(F(x)\)</span>比<span
class="math inline">\(H(x)\)</span>好学？</p></li>
<li><p><em>add more</em></p></li>
</ul>

    </div>

    
    
    
      


    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>Vincent Qin
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://www.vincentqin.tech/posts/matlab-deep-learning/" title="Matlab Deep Learning学习笔记">https://www.vincentqin.tech/posts/matlab-deep-learning/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Deep-Learning/" rel="tag"># Deep Learning</a>
              <a href="/tags/CNN/" rel="tag"># CNN</a>
              <a href="/tags/CIFAR10/" rel="tag"># CIFAR10</a>
              <a href="/tags/Matlab/" rel="tag"># Matlab</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/CNN-Architectures/" rel="prev" title="CNN框架(CNN Architectures)">
                  <i class="fa fa-chevron-left"></i> CNN框架(CNN Architectures)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/depth-estimation-using-deeplearning-1/" rel="next" title="深度学习在深度(视差)估计中的应用(1)">
                  深度学习在深度(视差)估计中的应用(1) <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2016 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Vincent Qin</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.6/mermaid.min.js","integrity":"sha256-ZfzwelSToHk5YAcr9wbXAmWgyn9Jyq08fSLrLhZE89w="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>



  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"en-US","enable":true,"serverURL":"https://comments.vincentqin.tech","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":true,"locale":{"placeholder":"Welcome to comment"},"emoji":["https://unpkg.com/@waline/emojis@1.1.0/weibo","https://unpkg.com/@waline/emojis@1.1.0/alus","https://unpkg.com/@waline/emojis@1.1.0/bilibili","https://unpkg.com/@waline/emojis@1.1.0/qq","https://unpkg.com/@waline/emojis@1.1.0/tieba","https://unpkg.com/@waline/emojis@1.1.0/tw-emoji"],"meta":["nick","mail","link"],"requiredMeta":["nick","mail"],"wordLimit":0,"login":"enable","el":"#waline","comment":true,"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","path":"/posts/matlab-deep-learning/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

</body>
</html>
